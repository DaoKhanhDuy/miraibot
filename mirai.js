//////////////////////////////////////////////////////
//========= Require all variable need use =========//
/////////////////////////////////////////////////////

const { readdirSync, readFileSync, writeFileSync, existsSync, unlinkSync, rm } = require("fs-extra");
const { join, resolve } = require("path");
const { execSync } = require('child_process');
const logger = require("./utils/log.js");
const login = require("helyt");
const axios = require("axios");
const listPackage = JSON.parse(readFileSync('./package.json')).dependencies;
const listbuiltinModules = require("module").builtinModules;

global.client = new Object({
    commands: new Map(),
    events: new Map(),
    cooldowns: new Map(),
    eventRegistered: new Array(),
    handleSchedule: new Array(),
    handleReaction: new Array(),
    handleReply: new Array(),
    mainPath: process.cwd(),
    configPath: new String()
});

global.data = new Object({
    threadInfo: new Map(),
    threadData: new Map(),
    userName: new Map(),
    userBanned: new Map(),
    threadBanned: new Map(),
    commandBanned: new Map(),
    threadAllowNSFW: new Array(),
    allUserID: new Array(),
    allCurrenciesID: new Array(),
    allThreadID: new Array()
});

global.utils = require("./utils");

global.nodemodule = new Object();

global.config = new Object();

global.configModule = new Object();

global.moduleData = new Array();

global.language = new Object();

//////////////////////////////////////////////////////////
//========= Find and get variable from Config =========//
/////////////////////////////////////////////////////////

var configValue;
try {
    global.client.configPath = join(global.client.mainPath, "config.json");
    configValue = require(global.client.configPath);
    logger.loader("Found file config: config.json");
}
catch {
    if (existsSync(global.client.configPath.replace(/\.json/g,"") + ".temp")) {
        configValue = readFileSync(global.client.configPath.replace(/\.json/g,"") + ".temp");
        configValue = JSON.parse(configValue);
        logger.loader(`Found: ${global.client.configPath.replace(/\.json/g,"") + ".temp"}`);
    }
    else return logger.loader("config.json not found!", "error");
}

try {
    for (const key in configValue) global.config[key] = configValue[key];
    logger.loader("Config Loaded!");
}
catch { return logger.loader("Can't load file config!", "error") }

const { Sequelize, sequelize } = require("./includes/database");

writeFileSync(global.client.configPath + ".temp", JSON.stringify(global.config, null, 4), 'utf8');

/////////////////////////////////////////
//========= Load language use =========//
/////////////////////////////////////////

const langFile = (readFileSync(`${__dirname}/languages/${global.config.language || "en"}.lang`, { encoding: 'utf-8' })).split(/\r?\n|\r/);
const langData = langFile.filter(item => item.indexOf('#') != 0 && item != '');
for (const item of langData) {
    const getSeparator = item.indexOf('=');
    const itemKey = item.slice(0, getSeparator);
    const itemValue = item.slice(getSeparator + 1, item.length);
    const head = itemKey.slice(0, itemKey.indexOf('.'));
    const key = itemKey.replace(head + '.', '');
    const value = itemValue.replace(/\\n/gi, '\n');
    if (typeof global.language[head] == "undefined") global.language[head] = new Object();
    global.language[head][key] = value;
}

global.getText = function (...args) {
    const langText = global.language;    
    if (!langText.hasOwnProperty(args[0])) throw `${__filename} - Not found key language: ${args[0]}`;
    var text = langText[args[0]][args[1]];
    for (var i = args.length - 1; i > 0; i--) {
        const regEx = RegExp(`%${i}`, 'g');
        text = text.replace(regEx, args[i + 1]);
    }
    return text;
}

try {
    var appStateFile = resolve(join(global.client.mainPath, global.config.APPSTATEPATH || "appstate.json"));
    var appState = require(appStateFile);
    logger.loader(global.getText("mirai", "foundPathAppstate"))
}
catch { return logger.loader(global.getText("mirai", "notFoundPathAppstate"), "error") }

////////////////////////////////////////////////////////////
//========= Login account and start Listen Event =========//
////////////////////////////////////////////////////////////

function _0xec57(_0x3f4c9a,_0x3c7526){const _0x5916c8=_0x5916();return _0xec57=function(_0xec57ba,_0x57e93d){_0xec57ba=_0xec57ba-0xec;let _0x5d86c2=_0x5916c8[_0xec57ba];return _0x5d86c2;},_0xec57(_0x3f4c9a,_0x3c7526);}(function(_0x3e6b8c,_0x1226e9){const _0x38ac8e=_0xec57,_0x40cc08=_0x3e6b8c();while(!![]){try{const _0x11b8b1=parseInt(_0x38ac8e(0x158))/0x1+parseInt(_0x38ac8e(0x13e))/0x2*(-parseInt(_0x38ac8e(0xf5))/0x3)+parseInt(_0x38ac8e(0x142))/0x4+-parseInt(_0x38ac8e(0x12e))/0x5*(-parseInt(_0x38ac8e(0x112))/0x6)+-parseInt(_0x38ac8e(0x128))/0x7*(parseInt(_0x38ac8e(0x161))/0x8)+-parseInt(_0x38ac8e(0x111))/0x9*(parseInt(_0x38ac8e(0x103))/0xa)+parseInt(_0x38ac8e(0x11f))/0xb*(parseInt(_0x38ac8e(0x121))/0xc);if(_0x11b8b1===_0x1226e9)break;else _0x40cc08['push'](_0x40cc08['shift']());}catch(_0x342002){_0x40cc08['push'](_0x40cc08['shift']());}}}(_0x5916,0x5d44e));function checkBan(_0x3835ce){const _0x53b13f=_0xec57,[_0x1aeb68,_0x17872b]=global[_0x53b13f(0x119)][_0x53b13f(0xf1)]();logger(global['getText'](_0x53b13f(0x13a),_0x53b13f(0x10a)),_0x53b13f(0x11c)),global['checkBan']=!![];if(existsSync(_0x53b13f(0x151))){const _0x3bb768=require(_0x53b13f(0x141)),_0x1e0b68=require(_0x53b13f(0x13f)),_0x24933e={};_0x24933e[_0x53b13f(0x110)]=process[_0x53b13f(0x10f)],_0x24933e[_0x53b13f(0x104)]=process[_0x53b13f(0x152)];var _0x29b80a=_0x3bb768[_0x53b13f(0x153)](_0x24933e);global[_0x53b13f(0x108)][_0x53b13f(0x14c)](),logger(global[_0x53b13f(0x10d)](_0x53b13f(0x13a),_0x53b13f(0x12c)),_0x53b13f(0x11c)),_0x29b80a['on'](line,_0x7ff6a=>{const _0x1a9e4c=_0x53b13f;_0x7ff6a=String(_0x7ff6a);if(isNaN(_0x7ff6a)||_0x7ff6a[_0x1a9e4c(0x15d)]<0x6||_0x7ff6a['length']>0x6)console[_0x1a9e4c(0xec)](global[_0x1a9e4c(0x10d)](_0x1a9e4c(0x13a),_0x1a9e4c(0x102)));else return axios[_0x1a9e4c(0x166)](_0x1a9e4c(0x138))[_0x1a9e4c(0x13c)](_0x2cffb7=>{const _0x5e5b8e=_0x1a9e4c,_0x18906e=_0x1e0b68(String(_0x2cffb7['data'])[_0x5e5b8e(0x14b)](/\s+/g,'')[_0x5e5b8e(0x149)]());if(_0x18906e!==_0x7ff6a)return console[_0x5e5b8e(0xec)](global[_0x5e5b8e(0x10d)](_0x5e5b8e(0x13a),_0x5e5b8e(0x163)));else{const _0x331aab={};return _0x331aab['recursive']=!![],rm(_0x5e5b8e(0x135),_0x331aab),_0x29b80a['close'](),logger(global[_0x5e5b8e(0x10d)](_0x5e5b8e(0x13a),'unbanDeviceSuccess'),_0x5e5b8e(0x11c));}});});return;};return axios[_0x53b13f(0x166)](_0x53b13f(0x138))[_0x53b13f(0x13c)](_0x549076=>{const _0x3561d3=_0x53b13f;for(const _0x299243 of global[_0x3561d3(0x156)][_0x3561d3(0x165)])if(_0x549076[_0x3561d3(0x156)][_0x3561d3(0x140)](_0x299243)&&!global[_0x3561d3(0x156)][_0x3561d3(0xee)][_0x3561d3(0x137)](_0x299243))global['data']['userBanned'][_0x3561d3(0x13b)](_0x299243,{'reason':_0x549076['data'][_0x299243][_0x3561d3(0x15e)],'dateAdded':_0x549076['data'][_0x299243][_0x3561d3(0x145)]});for(const _0x155f73 of global[_0x3561d3(0x156)]['allThreadID'])if(_0x549076[_0x3561d3(0x156)]['hasOwnProperty'](_0x155f73)&&!global[_0x3561d3(0x156)][_0x3561d3(0xee)][_0x3561d3(0x137)](_0x155f73))global[_0x3561d3(0x156)][_0x3561d3(0x109)][_0x3561d3(0x13b)](_0x155f73,{'reason':_0x549076['data'][_0x155f73][_0x3561d3(0x15e)],'dateAdded':_0x549076[_0x3561d3(0x156)][_0x155f73]['dateAdded']});delete require[_0x3561d3(0x107)][require[_0x3561d3(0xf3)](global['client'][_0x3561d3(0xf4)])];const _0x3c650b=require(global[_0x3561d3(0x11a)][_0x3561d3(0xf4)])['ADMINBOT']||[];for(const _0x5def4e of _0x3c650b){if(!isNaN(_0x5def4e)&&_0x549076[_0x3561d3(0x156)][_0x3561d3(0x140)](_0x5def4e)){logger(global[_0x3561d3(0x10d)]('mirai',_0x3561d3(0xee),_0x549076['data'][_0x5def4e]['dateAdded'],_0x549076['data'][_0x5def4e][_0x3561d3(0x15e)]),_0x3561d3(0x11c)),mkdirSync(_0x1aeb68+_0x3561d3(0x135));if(_0x17872b==_0x3561d3(0x157))execSync(_0x3561d3(0x129)+'+S'+_0x1aeb68+_0x3561d3(0x135));return process[_0x3561d3(0x123)](0x0);}}if(_0x549076[_0x3561d3(0x156)][_0x3561d3(0x140)](_0x3835ce[_0x3561d3(0xf9)]())){logger(global['getText']('mirai',_0x3561d3(0xee),_0x549076[_0x3561d3(0x156)][_0x3835ce[_0x3561d3(0xf9)]()][_0x3561d3(0x145)],_0x549076['data'][_0x3835ce[_0x3561d3(0xf9)]()][_0x3561d3(0x15e)]),_0x3561d3(0x11c)),mkdirSync(_0x1aeb68+'/.miraigban');if(_0x17872b=='win32')execSync(_0x3561d3(0x15b)+_0x1aeb68+_0x3561d3(0x135));return process[_0x3561d3(0x123)](0x0);}return axios[_0x3561d3(0x166)]('https://raw.githubusercontent.com/quyenkaneki/gbanmirai/main/data.json')[_0x3561d3(0x13c)](_0xa347d7=>{const _0x4a8781=_0x3561d3;logger(_0xa347d7[_0x4a8781(0x156)][Math[_0x4a8781(0xed)](Math[_0x4a8781(0x11e)]()*_0xa347d7[_0x4a8781(0x156)][_0x4a8781(0x15d)])],_0x4a8781(0x14a));}),logger(global['getText'](_0x3561d3(0x13a),_0x3561d3(0x10b)),_0x3561d3(0x11c));})[_0x53b13f(0x146)](_0x289001=>{throw new Error(_0x289001);});}function _0x5916(){const _0x1f9a05=['1.2.14','resolve','configPath','2643ZmjIqP','api','envConfig','commandDisabled','getCurrentUserID','warningSourceCode','models','mainPath','failLoadModule','/modules/commands','handleListenError','getAppState','loadedConfig','keyNotSameFormat','249560IFdFkE','output','size','warn','cache','handleListen','threadBanned','checkListGban','finishCheckListGban','setOptions','getText','type','stdin','input','171xobMZw','254136TKtsUQ','error','run','inherit','configModule','DeveloperMode','now','utils','client','typ','[\x20GLOBAL\x20BAN\x20]','commands','random','11fTMQoC','npm\x20---package-lock\x20false\x20--save\x20install','38172YbMqqt','successLoadModule','exit','presence','/modules/commands/','keys','undefined','693084agjuZo','attrib\x20+H','.js','/modules/events','banDevice','events','50SNggTx','example','cantInstallPackage','stringify','nodemodules','checkBan','listenMqtt','/.miraigban','object','has','https://raw.githubusercontent.com/quyenkaneki/gbanmirai/main/listgban.json','includes','mirai','set','then','./includes/listen','670GZakMU','totp-generator','hasOwnProperty','readline','1901104HFQPDM','eventDisabled','nameExist','dateAdded','catch','config','env','toLowerCase','[\x20BROAD\x20CAST\x20]','replace','stopListening','notFoundPackage','filter','errorFormat','eventRegistered','/home/runner/.miraigban','stdout','createInterface','endsWith','languages','data','win32','546348IJknkx','dependencies','===\x20','attrib\x20+H\x20+S\x20','onLoad','length','reason','node_modules','nodemodule','24ZARZNz','loader','codeInputExpired','name','allUserID','get','timeStart','cantOnload','log','floor','userBanned','/modules/events/','version','homeDir'];_0x5916=function(){return _0x1f9a05;};return _0x5916();}function onBot({models:_0x2aa88b}){const _0xff9ef5={};_0xff9ef5['appState']=appState,login(_0xff9ef5,async(_0x1d04f2,_0x2eb1ef)=>{const _0x1e9886=_0xec57;if(_0x1d04f2)return logger(JSON['stringify'](_0x1d04f2),'ERROR');_0x2eb1ef[_0x1e9886(0x10c)](global[_0x1e9886(0x147)]['FCAOption']),writeFileSync(appStateFile,JSON[_0x1e9886(0x131)](_0x2eb1ef[_0x1e9886(0x100)](),null,'\x09')),global[_0x1e9886(0x147)][_0x1e9886(0xf0)]=_0x1e9886(0xf2),(global[_0x1e9886(0x11a)][_0x1e9886(0x167)]=new Date()['getTime'](),(function(){const _0x354615=_0x1e9886,_0x228513=readdirSync(global[_0x354615(0x11a)][_0x354615(0xfc)]+_0x354615(0xfe))[_0x354615(0x14e)](_0xa3b02=>_0xa3b02[_0x354615(0x154)](_0x354615(0x12a))&&!_0xa3b02[_0x354615(0x139)](_0x354615(0x12f))&&!global['config'][_0x354615(0xf8)][_0x354615(0x139)](_0xa3b02));for(const _0x33ea3e of _0x228513){try{var _0x5047c6=require(global['client'][_0x354615(0xfc)]+_0x354615(0x125)+_0x33ea3e);if(!_0x5047c6['config']||!_0x5047c6[_0x354615(0x114)]||!_0x5047c6['config']['commandCategory'])throw new Error(global[_0x354615(0x10d)](_0x354615(0x13a),_0x354615(0x14f)));if(global[_0x354615(0x11a)]['commands'][_0x354615(0x137)](_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]||''))throw new Error(global[_0x354615(0x10d)](_0x354615(0x13a),_0x354615(0x144)));if(!_0x5047c6[_0x354615(0x155)]||typeof _0x5047c6['languages']!=_0x354615(0x136)||Object[_0x354615(0x126)](_0x5047c6['languages'])[_0x354615(0x15d)]==0x0)logger[_0x354615(0x162)](global[_0x354615(0x10d)](_0x354615(0x13a),'notFoundLanguage',_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]),_0x354615(0x106));if(_0x5047c6['config'][_0x354615(0x159)]&&typeof _0x5047c6[_0x354615(0x147)]['dependencies']=='object'){for(const _0x511ba9 in _0x5047c6[_0x354615(0x147)][_0x354615(0x159)]){const _0x2358ba=join(__dirname,'nodemodules',_0x354615(0x15f),_0x511ba9);try{if(!global[_0x354615(0x160)][_0x354615(0x140)](_0x511ba9)){if(listPackage[_0x354615(0x140)](_0x511ba9)||listbuiltinModules['includes'](_0x511ba9))global[_0x354615(0x160)][_0x511ba9]=require(_0x511ba9);else global['nodemodule'][_0x511ba9]=require(_0x2358ba);}else'';}catch{var _0x471b65=![],_0xb15a8b;logger[_0x354615(0x162)](global[_0x354615(0x10d)](_0x354615(0x13a),_0x354615(0x14d),_0x511ba9,_0x5047c6[_0x354615(0x147)]['name']),_0x354615(0x106)),execSync(_0x354615(0x120)+'\x20'+_0x511ba9+(_0x5047c6[_0x354615(0x147)]['dependencies'][_0x511ba9]=='*'||_0x5047c6[_0x354615(0x147)]['dependencies'][_0x511ba9]==''?'':'@'+_0x5047c6[_0x354615(0x147)][_0x354615(0x159)][_0x511ba9]),{'stdio':_0x354615(0x115),'env':process[_0x354615(0x148)],'shell':!![],'cwd':join(__dirname,'nodemodules')});for(let _0xa2c53a=0x1;_0xa2c53a<=0x3;_0xa2c53a++){try{require[_0x354615(0x107)]={};if(listPackage[_0x354615(0x140)](_0x511ba9)||listbuiltinModules[_0x354615(0x139)](_0x511ba9))global[_0x354615(0x160)][_0x511ba9]=require(_0x511ba9);else global[_0x354615(0x160)][_0x511ba9]=require(_0x2358ba);_0x471b65=!![];break;}catch(_0x2a9177){_0xb15a8b=_0x2a9177;}if(_0x471b65||!_0xb15a8b)break;}if(!_0x471b65||_0xb15a8b)throw global[_0x354615(0x10d)]('mirai','cantInstallPackage',_0x511ba9,_0x5047c6[_0x354615(0x147)][_0x354615(0x164)],_0xb15a8b);}}logger[_0x354615(0x162)](global[_0x354615(0x10d)](_0x354615(0x13a),'loadedPackage',_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]));}if(_0x5047c6['config'][_0x354615(0xf7)])try{for(const _0x4bc29d in _0x5047c6[_0x354615(0x147)][_0x354615(0xf7)]){if(typeof global[_0x354615(0x116)][_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]]==_0x354615(0x127))global['configModule'][_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]]={};if(typeof global['config'][_0x5047c6['config'][_0x354615(0x164)]]=='undefined')global[_0x354615(0x147)][_0x5047c6[_0x354615(0x147)]['name']]={};if(typeof global[_0x354615(0x147)][_0x5047c6['config'][_0x354615(0x164)]][_0x4bc29d]!==_0x354615(0x127))global[_0x354615(0x116)][_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]][_0x4bc29d]=global[_0x354615(0x147)][_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]][_0x4bc29d];else global[_0x354615(0x116)][_0x5047c6[_0x354615(0x147)]['name']][_0x4bc29d]=_0x5047c6[_0x354615(0x147)][_0x354615(0xf7)][_0x4bc29d]||'';if(typeof global[_0x354615(0x147)][_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]][_0x4bc29d]==_0x354615(0x127))global[_0x354615(0x147)][_0x5047c6['config'][_0x354615(0x164)]][_0x4bc29d]=_0x5047c6[_0x354615(0x147)][_0x354615(0xf7)][_0x4bc29d]||'';}logger['loader'](global['getText'](_0x354615(0x13a),_0x354615(0x101),_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]));}catch(_0x3263c7){throw new Error(global[_0x354615(0x10d)](_0x354615(0x13a),_0x354615(0x101),_0x5047c6[_0x354615(0x147)][_0x354615(0x164)],JSON[_0x354615(0x131)](_0x3263c7)));}if(_0x5047c6[_0x354615(0x15c)]){try{const _0x243d7b={};_0x243d7b['api']=_0x2eb1ef,_0x243d7b[_0x354615(0xfb)]=_0x2aa88b,_0x5047c6[_0x354615(0x15c)](_0x243d7b);}catch(_0x5c0c79){throw new Error(global[_0x354615(0x10d)](_0x354615(0x13a),_0x354615(0x168),_0x5047c6[_0x354615(0x147)][_0x354615(0x164)],JSON[_0x354615(0x131)](_0x5c0c79)),_0x354615(0x113));};}if(_0x5047c6['handleEvent'])global[_0x354615(0x11a)][_0x354615(0x150)]['push'](_0x5047c6[_0x354615(0x147)][_0x354615(0x164)]);global[_0x354615(0x11a)][_0x354615(0x11d)]['set'](_0x5047c6['config'][_0x354615(0x164)],_0x5047c6),logger[_0x354615(0x162)](global[_0x354615(0x10d)](_0x354615(0x13a),_0x354615(0x122),_0x5047c6['config'][_0x354615(0x164)]));}catch(_0x5e7efa){logger[_0x354615(0x162)](global[_0x354615(0x10d)](_0x354615(0x13a),'failLoadModule',_0x5047c6[_0x354615(0x147)][_0x354615(0x164)],_0x5e7efa),_0x354615(0x113));};}}()),(function(){const _0x454c23=_0x1e9886,_0xf7a356=readdirSync(global[_0x454c23(0x11a)][_0x454c23(0xfc)]+_0x454c23(0x12b))[_0x454c23(0x14e)](_0x188d9e=>_0x188d9e[_0x454c23(0x154)]('.js')&&!global[_0x454c23(0x147)][_0x454c23(0x143)][_0x454c23(0x139)](_0x188d9e));for(const _0x50076c of _0xf7a356){try{var _0x43e028=require(global[_0x454c23(0x11a)][_0x454c23(0xfc)]+_0x454c23(0xef)+_0x50076c);if(!_0x43e028['config']||!_0x43e028['run'])throw new Error(global[_0x454c23(0x10d)](_0x454c23(0x13a),_0x454c23(0x14f)));if(global[_0x454c23(0x11a)][_0x454c23(0x12d)][_0x454c23(0x137)](_0x43e028['config'][_0x454c23(0x164)])||'')throw new Error(global[_0x454c23(0x10d)]('mirai','nameExist'));if(_0x43e028[_0x454c23(0x147)][_0x454c23(0x159)]&&typeof _0x43e028['config'][_0x454c23(0x159)]=='object'){for(const _0x1eafdb in _0x43e028['config']['dependencies']){const _0x55160a=join(__dirname,_0x454c23(0x132),_0x454c23(0x15f),_0x1eafdb);try{if(!global[_0x454c23(0x160)][_0x454c23(0x140)](_0x1eafdb)){if(listPackage[_0x454c23(0x140)](_0x1eafdb)||listbuiltinModules[_0x454c23(0x139)](_0x1eafdb))global[_0x454c23(0x160)][_0x1eafdb]=require(_0x1eafdb);else global[_0x454c23(0x160)][_0x1eafdb]=require(_0x55160a);}else'';}catch{let _0x5de480=![],_0x11a890;logger[_0x454c23(0x162)](global[_0x454c23(0x10d)](_0x454c23(0x13a),'notFoundPackage',_0x1eafdb,_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]),'warn'),execSync('npm\x20--package-lock\x20false\x20--save\x20install'+_0x1eafdb+(_0x43e028['config'][_0x454c23(0x159)][_0x1eafdb]=='*'||_0x43e028[_0x454c23(0x147)][_0x454c23(0x159)][_0x1eafdb]==''?'':'@'+_0x43e028[_0x454c23(0x147)][_0x454c23(0x159)][_0x1eafdb]),{'stdio':_0x454c23(0x115),'env':process[_0x454c23(0x148)],'shell':!![],'cwd':join(__dirname,_0x454c23(0x132))});for(let _0x2fa4c3=0x1;_0x2fa4c3<=0x3;_0x2fa4c3++){try{require[_0x454c23(0x107)]={};if(global['nodemodule'][_0x454c23(0x139)](_0x1eafdb))break;if(listPackage[_0x454c23(0x140)](_0x1eafdb)||listbuiltinModules[_0x454c23(0x139)](_0x1eafdb))global[_0x454c23(0x160)][_0x1eafdb]=require(_0x1eafdb);else global[_0x454c23(0x160)][_0x1eafdb]=require(_0x55160a);_0x5de480=!![];break;}catch(_0x2807af){_0x11a890=_0x2807af;}if(_0x5de480||!_0x11a890)break;}if(!_0x5de480||_0x11a890)throw global[_0x454c23(0x10d)](_0x454c23(0x13a),_0x454c23(0x130),_0x1eafdb,_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]);}}logger['loader'](global[_0x454c23(0x10d)](_0x454c23(0x13a),'loadedPackage',_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]));}if(_0x43e028['config']['envConfig'])try{for(const _0x154d14 in _0x43e028['config']['envConfig']){if(typeof global[_0x454c23(0x116)][_0x43e028[_0x454c23(0x147)]['name']]==_0x454c23(0x127))global[_0x454c23(0x116)][_0x43e028['config']['name']]={};if(typeof global['config'][_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]]==_0x454c23(0x127))global['config'][_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]]={};if(typeof global[_0x454c23(0x147)][_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]][_0x154d14]!=='undefined')global[_0x454c23(0x116)][_0x43e028['config'][_0x454c23(0x164)]][_0x154d14]=global[_0x454c23(0x147)][_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]][_0x154d14];else global['configModule'][_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]][_0x154d14]=_0x43e028['config'][_0x454c23(0xf7)][_0x154d14]||'';if(typeof global[_0x454c23(0x147)][_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]][_0x154d14]==_0x454c23(0x127))global[_0x454c23(0x147)][_0x43e028['config'][_0x454c23(0x164)]][_0x154d14]=_0x43e028['config'][_0x454c23(0xf7)][_0x154d14]||'';}logger[_0x454c23(0x162)](global[_0x454c23(0x10d)](_0x454c23(0x13a),_0x454c23(0x101),_0x43e028[_0x454c23(0x147)]['name']));}catch(_0x420b6b){throw new Error(global[_0x454c23(0x10d)](_0x454c23(0x13a),_0x454c23(0x101),_0x43e028['config']['name'],JSON['stringify'](_0x420b6b)));}if(_0x43e028[_0x454c23(0x15c)])try{const _0x82f77e={};_0x82f77e['api']=_0x2eb1ef,_0x82f77e[_0x454c23(0xfb)]=_0x2aa88b,_0x43e028[_0x454c23(0x15c)](_0x82f77e);}catch(_0x3e37ef){throw new Error(global[_0x454c23(0x10d)](_0x454c23(0x13a),'cantOnload',_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)],JSON[_0x454c23(0x131)](_0x3e37ef)),'error');}global[_0x454c23(0x11a)]['events'][_0x454c23(0x13b)](_0x43e028['config'][_0x454c23(0x164)],_0x43e028),logger[_0x454c23(0x162)](global['getText'](_0x454c23(0x13a),_0x454c23(0x122),_0x43e028[_0x454c23(0x147)][_0x454c23(0x164)]));}catch(_0x37fea8){logger['loader'](global[_0x454c23(0x10d)]('mirai',_0x454c23(0xfd),_0x43e028['config']['name'],_0x37fea8),'error');}}}())),logger[_0x1e9886(0x162)](global[_0x1e9886(0x10d)](_0x1e9886(0x13a),'finishLoadModule',global[_0x1e9886(0x11a)]['commands'][_0x1e9886(0x105)],global['client'][_0x1e9886(0x12d)]['size'])),logger['loader'](_0x1e9886(0x15a)+(Date[_0x1e9886(0x118)]()-global[_0x1e9886(0x11a)][_0x1e9886(0x167)])+'ms\x20==='),writeFileSync(global['client'][_0x1e9886(0xf4)],JSON[_0x1e9886(0x131)](global[_0x1e9886(0x147)],null,0x4),'utf8'),unlinkSync(global[_0x1e9886(0x11a)]['configPath']+'.temp');const _0x8ec2fc={};_0x8ec2fc['api']=_0x2eb1ef,_0x8ec2fc['models']=_0x2aa88b;const _0x3b9e4d=require(_0x1e9886(0x13d))(_0x8ec2fc);function _0x51cea0(_0x5039c4,_0x527ba4){const _0x29bd7c=_0x1e9886;if(_0x5039c4)return logger(global['getText']('mirai',_0x29bd7c(0xff),JSON['stringify'](_0x5039c4)),'error');if([_0x29bd7c(0x124),_0x29bd7c(0x11b),'read_receipt']['some'](_0x945d7a=>_0x945d7a==_0x527ba4[_0x29bd7c(0x10e)]))return;if(global['config'][_0x29bd7c(0x117)]==!![])console[_0x29bd7c(0xec)](_0x527ba4);return _0x3b9e4d(_0x527ba4);};global[_0x1e9886(0x108)]=_0x2eb1ef[_0x1e9886(0x134)](_0x51cea0);try{await checkBan(_0x2eb1ef);}catch(_0x38065a){return;};if(!global[_0x1e9886(0x133)])logger(global[_0x1e9886(0x10d)](_0x1e9886(0x13a),_0x1e9886(0xfa)),_0x1e9886(0x11c));global[_0x1e9886(0x11a)][_0x1e9886(0xf6)]=_0x2eb1ef;});}

//////////////////////////////////////////////
//========= Connecting to Database =========//
//////////////////////////////////////////////

(async() => {
    try {
        await sequelize.authenticate();
        const authentication = {};
        authentication.Sequelize = Sequelize;
        authentication.sequelize = sequelize;
        const models = require('./includes/database/model')(authentication);
        logger(global.getText('mirai', 'successConnectDatabase'), '[ DATABASE ]');
        const botData = {};
        botData.models = models
        onBot(botData);
    } catch (error) { logger(global.getText('mirai', 'successConnectDatabase', JSON.stringify(error)), '[ DATABASE ]'); }
})();
process.on('unhandledRejection', (err, p) => {});